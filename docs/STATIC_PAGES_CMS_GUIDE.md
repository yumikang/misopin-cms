# ì •ì  í˜ì´ì§€ CMS ì‹œìŠ¤í…œ ê°€ì´ë“œ

## ëª©ì°¨
1. [ì‹œìŠ¤í…œ ê°œìš”](#ì‹œìŠ¤í…œ-ê°œìš”)
2. [ì•„í‚¤í…ì²˜](#ì•„í‚¤í…ì²˜)
3. [CMS ì‚¬ìš© ê°€ì´ë“œ](#cms-ì‚¬ìš©-ê°€ì´ë“œ)
4. [ë°°í¬ ë° ë„ë©”ì¸ ì„¤ì •](#ë°°í¬-ë°-ë„ë©”ì¸-ì„¤ì •)
5. [ë¬¸ì œ í•´ê²°](#ë¬¸ì œ-í•´ê²°)
6. [ê¸°ìˆ  ìƒì„¸](#ê¸°ìˆ -ìƒì„¸)

---

## ì‹œìŠ¤í…œ ê°œìš”

### ëª©ì 
ì •ì  HTML í˜ì´ì§€ì˜ ì½˜í…ì¸ ë¥¼ CMSì—ì„œ ì§ì ‘ í¸ì§‘í•˜ê³ , ì‹¤ì‹œê°„ìœ¼ë¡œ ë¼ì´ë¸Œ ì‚¬ì´íŠ¸ì— ë°˜ì˜í•˜ëŠ” ì‹œìŠ¤í…œ

### ì£¼ìš” ê¸°ëŠ¥
- âœ… ì›¹ ê¸°ë°˜ WYSIWYG í¸ì§‘ ì¸í„°í˜ì´ìŠ¤
- âœ… ì‹¤ì‹œê°„ HTML íŒŒì¼ ë™ê¸°í™”
- âœ… ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… ë° ë²„ì „ ê´€ë¦¬
- âœ… XSS ë³´í˜¸ ë° HTML ê²€ì¦
- âœ… ì„¹ì…˜ë³„ êµ¬ì¡°í™”ëœ í¸ì§‘
- âœ… ì´ë¯¸ì§€ URL ê´€ë¦¬

### ì§€ì› í˜ì´ì§€ í˜„í™© (ì´ 19ê°œ)

#### í¸ì§‘ ê°€ëŠ¥ í˜ì´ì§€ (13ê°œ)
| í˜ì´ì§€ | ì„¤ëª… | í¸ì§‘ ìš”ì†Œ ìˆ˜ |
|--------|------|--------------|
| index | ë©”ì¸ í˜ì´ì§€ | 25ê°œ |
| botox | ë³´í†¡ìŠ¤ | 34ê°œ |
| diet | ë‹¤ì´ì–´íŠ¸ | 38ê°œ |
| lifting | ë¦¬í”„íŒ… | 23ê°œ |
| filler | í•„ëŸ¬ | 26ê°œ |
| jeomin | ì œì˜¤ë¯¼ | 24ê°œ |
| skinbooster | ìŠ¤í‚¨ë¶€ìŠ¤í„° | 26ê°œ |
| acne | ì—¬ë“œë¦„ì¹˜ë£Œ | 25ê°œ |
| hair-removal | ì œëª¨ | 22ê°œ |
| peeling | í•„ë§ | 24ê°œ |
| mole | ì  | 26ê°œ |
| milia | ë¹„ë¦½ì¢… | 13ê°œ |
| tattoo | ë¬¸ì‹ ì œê±° | 16ê°œ |

#### í¸ì§‘ ìš”ì†Œ ì—†ëŠ” í˜ì´ì§€ (6ê°œ)
- about (ë³‘ì› ì†Œê°œ)
- board-page (ê³µì§€ ë° ì´ë²¤íŠ¸)
- calendar-page (ì˜¨ë¼ì¸ ìƒë‹´)
- fee-schedule (ë¹„ê¸‰ì—¬ ìˆ˜ê°€í‘œ)
- privacy (ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨)
- stipulation (ì´ìš©ì•½ê´€)

---

## ì•„í‚¤í…ì²˜

### ì‹œìŠ¤í…œ êµ¬ì¡°ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ì‚¬ìš©ì ë¸Œë¼ìš°ì €                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  CMS ê´€ë¦¬ì                    â”‚  ì¼ë°˜ ì‚¬ìš©ì                 â”‚
â”‚  cms.one-q.xyz/admin           â”‚  misopin.one-q.xyz          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                     â”‚
           â”‚ HTTPS                               â”‚ HTTPS
           â–¼                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Caddy Web Server                           â”‚
â”‚                    (VPS: 141.164.60.51)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  /api/*  â”€â”€â”€â”€â”€â”€â–º Next.js (port 3001)                         â”‚
â”‚  /*.html â”€â”€â”€â”€â”€â”€â–º /var/www/misopin-cms/.next/.../static-pages â”‚
â”‚  /css,js â”€â”€â”€â”€â”€â”€â–º /var/www/misopin.com                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Next.js CMS App                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ StaticPageEditor.tsx (í¸ì§‘ UI)                            â”‚
â”‚  â€¢ /api/admin/static-pages/[slug]/elements (ì €ì¥ API)       â”‚
â”‚  â€¢ attribute-updater.ts (HTML íŒŒì¼ ìˆ˜ì •)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PostgreSQL Database                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ static_pages (í˜ì´ì§€ ë©”íƒ€ë°ì´í„°)                          â”‚
â”‚  â€¢ editable_elements (í¸ì§‘ ê°€ëŠ¥ ìš”ì†Œ)                        â”‚
â”‚  â€¢ static_page_versions (ë²„ì „ íˆìŠ¤í† ë¦¬)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë°ì´í„° íë¦„

#### 1. í¸ì§‘ ë° ì €ì¥ í”„ë¡œì„¸ìŠ¤
```
1. ì‚¬ìš©ìê°€ CMSì—ì„œ í…ìŠ¤íŠ¸ í¸ì§‘
   â†“
2. StaticPageEditor.tsxì—ì„œ ë³€ê²½ì‚¬í•­ ê°ì§€
   â†“
3. "ì €ì¥" ë²„íŠ¼ í´ë¦­ ì‹œ API í˜¸ì¶œ
   POST /api/admin/static-pages/[slug]/elements
   Body: { updates: [{elementId, newValue, elementType}] }
   â†“
4. ì„œë²„ ì¸¡ ê²€ì¦ (XSS, ë¹ˆ ê°’ ì²´í¬)
   â†“
5. DOMPurifyë¡œ HTML ìƒˆë‹ˆíƒ€ì´ì¦ˆ
   â†“
6. Cheerioë¡œ HTML íŒŒì¼ íŒŒì‹± ë° ì—…ë°ì´íŠ¸
   â†“
7. ë°±ì—… íŒŒì¼ ìƒì„± (.backup)
   â†“
8. ì‹¤ì œ HTML íŒŒì¼ ì €ì¥
   /var/www/misopin-cms/.next/standalone/public/static-pages/
   â†“
9. ë°ì´í„°ë² ì´ìŠ¤ ë™ê¸°í™”
   â†“
10. ì„±ê³µ ì‘ë‹µ ë°˜í™˜
```

#### 2. ë¼ì´ë¸Œ ì‚¬ì´íŠ¸ ë°˜ì˜
```
ì‚¬ìš©ìê°€ misopin.one-q.xyz/botox.html ì ‘ì†
   â†“
Caddyê°€ ìš”ì²­ ìˆ˜ì‹ 
   â†“
handle /*.html ê·œì¹™ ì ìš©
   â†“
/var/www/misopin-cms/.next/standalone/public/static-pages/botox.html ì œê³µ
   â†“
CSS/JS/ì´ë¯¸ì§€ëŠ” /var/www/misopin.comì—ì„œ ì œê³µ
```

---

## CMS ì‚¬ìš© ê°€ì´ë“œ

### ê´€ë¦¬ì ì ‘ì†

1. **CMS ë¡œê·¸ì¸**
   - URL: `https://cms.one-q.xyz/admin`
   - ê´€ë¦¬ì ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸

2. **ì •ì  í˜ì´ì§€ ê´€ë¦¬**
   - ì¢Œì¸¡ ë©”ë‰´: "ì •ì  í˜ì´ì§€ ê´€ë¦¬" í´ë¦­
   - ë˜ëŠ” ì§ì ‘ URL: `https://cms.one-q.xyz/admin/static-pages`

### í˜ì´ì§€ í¸ì§‘í•˜ê¸°

#### 1. í˜ì´ì§€ ëª©ë¡ì—ì„œ ì„ íƒ
```
ì •ì  í˜ì´ì§€ ëª©ë¡ í™”ë©´
â”œâ”€ ë©”ì¸ í˜ì´ì§€ (index)
â”œâ”€ ë³´í†¡ìŠ¤ (botox)
â”œâ”€ ë¦¬í”„íŒ… (lifting)
â””â”€ ... (ê¸°íƒ€ í˜ì´ì§€ë“¤)
```

ê° í˜ì´ì§€ ì¹´ë“œì—ì„œ "í¸ì§‘" ë²„íŠ¼ í´ë¦­

#### 2. í¸ì§‘ í™”ë©´ êµ¬ì¡°
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ì €ì¥] [ì·¨ì†Œ]              ë§ˆì§€ë§‰ ì €ì¥: XXë¶„ ì „ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ë©”ì¸ í˜ì´ì§€ í¸ì§‘                             â”‚
â”‚  ê° ì„¹ì…˜ì„ í´ë¦­í•˜ì—¬ í¼ì¹˜ê³ , ë‚´ìš©ì„ ìˆ˜ì •í•˜ì„¸ìš”  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ  ë©”ì¸ ìŠ¬ë¼ì´ë“œ            [â–¼] 3ê°œ í•­ëª©    â”‚
â”‚  â”œâ”€ ğŸ“ ìŠ¬ë¼ì´ë“œ 1 ì œëª©                       â”‚
â”‚  â”‚   [ì˜¨ë‹¤ë¦¬í”„íŒ…________________]            â”‚
â”‚  â”œâ”€ ğŸ“ ìŠ¬ë¼ì´ë“œ 1 ì„¤ëª…                       â”‚
â”‚  â”‚   [í…ìŠ¤íŠ¸ ì˜ì—­______________]            â”‚
â”‚  â””â”€ ğŸ–¼ï¸ ìŠ¬ë¼ì´ë“œ 1 ì´ë¯¸ì§€                    â”‚
â”‚      [ì´ë¯¸ì§€ URL_____________]               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ’‰ ì‹œìˆ  ì†Œê°œ               [â–¼] 5ê°œ í•­ëª©     â”‚
â”‚  â””â”€ ... (ì„¹ì…˜ í´ë¦­ ì‹œ í¼ì³ì§)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3. ìš”ì†Œ íƒ€ì…ë³„ í¸ì§‘ ë°©ë²•

**TEXT (ì¼ë°˜ í…ìŠ¤íŠ¸)**
- í•œ ì¤„ ë˜ëŠ” ì—¬ëŸ¬ ì¤„ í…ìŠ¤íŠ¸
- Enterë¡œ ì¤„ë°”ê¿ˆ (ìë™ìœ¼ë¡œ `<br>` íƒœê·¸ë¡œ ë³€í™˜)
- ì˜ˆ: ì œëª©, ì„¤ëª… ë¬¸êµ¬

**HTML (ì„œì‹ ìˆëŠ” í…ìŠ¤íŠ¸)**
- ì§ì ‘ HTML í¸ì§‘ ê°€ëŠ¥
- êµµê²Œ, ì´íƒ¤ë¦­, ë§í¬ ë“± ì„œì‹ í¬í•¨
- `contentEditable` ë°©ì‹ìœ¼ë¡œ í¸ì§‘
- ì˜ˆ: ìƒì„¸ ì„¤ëª…, ë¦¬ìŠ¤íŠ¸

**IMAGE (ì´ë¯¸ì§€)**
- ì´ë¯¸ì§€ URL ì…ë ¥
- ë¯¸ë¦¬ë³´ê¸° ìë™ í‘œì‹œ
- URL ì˜¤ë¥˜ ì‹œ "ì´ë¯¸ì§€ ì—†ìŒ" í‘œì‹œ
- ì˜ˆ: `/images/botox-main.jpg`

**BACKGROUND (ë°°ê²½ ì´ë¯¸ì§€)**
- í˜„ì¬ í¸ì§‘ UIì—ì„œ ì œì™¸ë¨
- ì´ë¯¸ì§€ URLì€ ë³„ë„ ê´€ë¦¬ í•„ìš”

#### 4. ì €ì¥í•˜ê¸°

1. ì½˜í…ì¸  ìˆ˜ì • ì™„ë£Œ
2. ìƒë‹¨ì˜ **[ì €ì¥]** ë²„íŠ¼ í´ë¦­
3. ì €ì¥ ì¤‘... í‘œì‹œ
4. ì„±ê³µ ì‹œ: "ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤" ë©”ì‹œì§€
5. ì‹¤íŒ¨ ì‹œ: ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ

#### 5. ë³€ê²½ì‚¬í•­ í™•ì¸

ì €ì¥ í›„ ì¦‰ì‹œ:
- ë¼ì´ë¸Œ ì‚¬ì´íŠ¸ì—ì„œ í™•ì¸: `https://misopin.one-q.xyz/[í˜ì´ì§€].html`
- ì˜ˆ: ë³´í†¡ìŠ¤ í˜ì´ì§€ ìˆ˜ì • í›„ â†’ `https://misopin.one-q.xyz/botox.html`

---

## ë°°í¬ ë° ë„ë©”ì¸ ì„¤ì •

### í˜„ì¬ ë°°í¬ í™˜ê²½

```yaml
ì„œë²„: VPS (141.164.60.51)
ì›¹ì„œë²„: Caddy v2.10.2
ì•±: Next.js 15.5.3 (standalone build)
ë°ì´í„°ë² ì´ìŠ¤: PostgreSQL
ì„ì‹œ ë„ë©”ì¸: misopin.one-q.xyz
```

### Caddy ì„¤ì • íŒŒì¼ ìœ„ì¹˜
```
/etc/caddy/Caddyfile
```

### í˜„ì¬ Caddyfile êµ¬ì¡°

```caddy
# misopin.one-q.xyz - Static pages
misopin.one-q.xyz {
    # ê¸°ë³¸ root: CSS/JS/ì´ë¯¸ì§€ìš©
    root * /var/www/misopin.com

    # API ìš”ì²­ì€ CMSë¡œ í”„ë¡ì‹œ
    handle /api/* {
        reverse_proxy localhost:3001
    }

    # HTML íŒŒì¼ì€ CMS ê²½ë¡œì—ì„œ ì œê³µ
    handle /*.html {
        root * /var/www/misopin-cms/.next/standalone/public/static-pages
        try_files {path}
        file_server
    }

    # ë£¨íŠ¸ ê²½ë¡œë„ CMSì˜ index.htmlë¡œ
    handle / {
        root * /var/www/misopin-cms/.next/standalone/public/static-pages
        try_files /index.html
        file_server
    }

    # ë‚˜ë¨¸ì§€ íŒŒì¼ì€ ê¸°ì¡´ ê²½ë¡œ
    handle {
        file_server
    }

    # ì••ì¶•
    encode gzip

    # ë³´ì•ˆ í—¤ë”
    header {
        X-Content-Type-Options "nosniff"
        X-Frame-Options "SAMEORIGIN"
        X-XSS-Protection "1; mode=block"
    }

    # ì´ë¯¸ì§€ ìºì‹± (30ì¼)
    header @images Cache-Control "public, max-age=2592000"
    @images {
        path *.jpg *.jpeg *.png *.gif *.webp *.svg *.ico *.mp4
    }

    # CSS/JS ìºì‹± (7ì¼)
    header @static Cache-Control "public, max-age=604800"
    @static {
        path *.css *.js
    }

    # HTML no-cache
    header @html Cache-Control "no-cache, no-store, must-revalidate"
    @html {
        path *.html /
    }

    # ë¡œê¹…
    log {
        output file /var/log/caddy/misopin-static.log
    }
}
```

### ë„ë©”ì¸ ë³€ê²½ ê°€ì´ë“œ (ìµœì¢… ë‚©í’ˆ ì‹œ)

#### 1. Caddyfile ìˆ˜ì •

VPSì— SSH ì ‘ì†:
```bash
ssh user@141.164.60.51
```

Caddyfile í¸ì§‘:
```bash
sudo nano /etc/caddy/Caddyfile
```

**ë³€ê²½ ì „:**
```caddy
misopin.one-q.xyz {
    # ... ì„¤ì •ë“¤ ...
}
```

**ë³€ê²½ í›„:**
```caddy
your-production-domain.com {  # ì‹¤ì œ ë„ë©”ì¸ìœ¼ë¡œ ë³€ê²½
    # ... ë™ì¼í•œ ì„¤ì •ë“¤ ...
}
```

#### 2. Caddy ì¬ì‹œì‘

```bash
# ì„¤ì • íŒŒì¼ ë¬¸ë²• ê²€ì‚¬
sudo caddy validate --config /etc/caddy/Caddyfile

# Caddy ì¬ì‹œì‘ (ì¶”ì²œ: ë¬´ì¤‘ë‹¨)
sudo systemctl reload caddy

# ë˜ëŠ” ì „ì²´ ì¬ì‹œì‘
sudo systemctl restart caddy

# ìƒíƒœ í™•ì¸
sudo systemctl status caddy
```

#### 3. DNS ì„¤ì •

ë„ë©”ì¸ ê´€ë¦¬ í˜ì´ì§€ì—ì„œ A ë ˆì½”ë“œ ì¶”ê°€:

```
Type    Name    Value           TTL
A       @       141.164.60.51   3600
A       www     141.164.60.51   3600
```

#### 4. SSL ì¸ì¦ì„œ ìë™ ë°œê¸‰ í™•ì¸

CaddyëŠ” ìë™ìœ¼ë¡œ Let's Encrypt SSL ì¸ì¦ì„œë¥¼ ë°œê¸‰í•©ë‹ˆë‹¤.

ë¡œê·¸ í™•ì¸:
```bash
sudo journalctl -u caddy -f
```

ì •ìƒ ë°œê¸‰ ì‹œ ë¡œê·¸:
```
[INFO] obtaining certificate for your-domain.com
[INFO] certificate obtained successfully
```

#### 5. ë³€ê²½í•˜ì§€ ì•Šì•„ë„ ë˜ëŠ” ê²ƒë“¤

âœ… **ê·¸ëŒ€ë¡œ ìœ ì§€:**
- HTML íŒŒì¼ ê²½ë¡œ
- CSS/JS/ì´ë¯¸ì§€ ê²½ë¡œ
- API í¬íŠ¸ ì„¤ì •
- Next.js ì•± ì„¤ì •
- ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
- ëª¨ë“  CMS ì„¤ì •

âŒ **ë³€ê²½ í•„ìš”:**
- Caddyfileì˜ ë„ë©”ì¸ ë¶€ë¶„ë§Œ
- DNS A ë ˆì½”ë“œ

### íŒŒì¼ ê²½ë¡œ ì •ë¦¬

```
/var/www/
â”œâ”€â”€ misopin.com/                          # ê¸°ì¡´ ì •ì  ë¦¬ì†ŒìŠ¤
â”‚   â”œâ”€â”€ css/                              # CSS íŒŒì¼ë“¤
â”‚   â”œâ”€â”€ js/                               # JavaScript íŒŒì¼ë“¤
â”‚   â”œâ”€â”€ images/                           # ì´ë¯¸ì§€ íŒŒì¼ë“¤
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ misopin-cms/
    â””â”€â”€ .next/
        â””â”€â”€ standalone/
            â””â”€â”€ public/
                â””â”€â”€ static-pages/          # CMS ê´€ë¦¬ HTML íŒŒì¼
                    â”œâ”€â”€ index.html         # âœ… CMSì—ì„œ í¸ì§‘ë¨
                    â”œâ”€â”€ botox.html         # âœ… CMSì—ì„œ í¸ì§‘ë¨
                    â”œâ”€â”€ lifting.html       # âœ… CMSì—ì„œ í¸ì§‘ë¨
                    â”œâ”€â”€ diet.html          # âœ… CMSì—ì„œ í¸ì§‘ë¨
                    â””â”€â”€ ...                # ë‚˜ë¨¸ì§€ í˜ì´ì§€ë“¤
```

---

## ë¬¸ì œ í•´ê²°

### í¸ì§‘ í›„ ì €ì¥ ì‹¤íŒ¨

#### ì¦ìƒ
- "ì €ì¥ ì‹¤íŒ¨" ë©”ì‹œì§€ í‘œì‹œ
- 400 ì—ëŸ¬ ì‘ë‹µ

#### í•´ê²° ë°©ë²•

**1. ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ í™•ì¸**
```
F12 â†’ Network íƒ­ â†’ elements ìš”ì²­ í™•ì¸
```

**2. ìš”ì²­ Payload í™•ì¸**
```json
{
  "updates": [
    {
      "elementId": "index-slide1-title",
      "newValue": "ìˆ˜ì •ëœ í…ìŠ¤íŠ¸",
      "elementType": "TEXT"
    }
  ]
}
```

**3. ì‘ë‹µ ì—ëŸ¬ í™•ì¸**
```json
{
  "success": false,
  "error": "ì—ëŸ¬ ë©”ì‹œì§€",
  "code": "VALIDATION_ERROR"
}
```

**4. ì¼ë°˜ì ì¸ ì—ëŸ¬ ì›ì¸**

| ì—ëŸ¬ ë©”ì‹œì§€ | ì›ì¸ | í•´ê²° |
|------------|------|------|
| updates ë°°ì—´ì´ í•„ìš”í•©ë‹ˆë‹¤ | Payload í˜•ì‹ ì˜¤ë¥˜ | ê°œë°œì ë„êµ¬ì—ì„œ ìš”ì²­ í™•ì¸ |
| ê° ì—…ë°ì´íŠ¸ëŠ” elementId, newValue, elementTypeì„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤ | í•„ìˆ˜ í•„ë“œ ëˆ„ë½ | ìš”ì†Œ íƒ€ì… í™•ì¸ |
| Invalid background image URL | BACKGROUND ìš”ì†Œë¥¼ í…ìŠ¤íŠ¸ë¡œ í¸ì§‘ | ì´ë¯¸ì§€ URL í™•ì¸ |
| XSS validation failed | ìœ„í—˜í•œ ìŠ¤í¬ë¦½íŠ¸ ê°ì§€ | í—ˆìš©ëœ HTML íƒœê·¸ë§Œ ì‚¬ìš© |

### í¸ì§‘ì€ ë˜ì§€ë§Œ ì‚¬ì´íŠ¸ì— ë°˜ì˜ ì•ˆ ë¨

#### ì›ì¸
- Caddy ì„¤ì • ë¬¸ì œ
- HTML íŒŒì¼ ê²½ë¡œ ë¶ˆì¼ì¹˜
- ìºì‹œ ë¬¸ì œ

#### í™•ì¸ ë‹¨ê³„

**1. HTML íŒŒì¼ì´ ì‹¤ì œë¡œ ìˆ˜ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸**
```bash
ssh user@141.164.60.51

# íŒŒì¼ ìˆ˜ì • ì‹œê°„ í™•ì¸
ls -lh /var/www/misopin-cms/.next/standalone/public/static-pages/index.html

# íŒŒì¼ ë‚´ìš© í™•ì¸
grep "ìˆ˜ì •í•œí…ìŠ¤íŠ¸" /var/www/misopin-cms/.next/standalone/public/static-pages/index.html
```

**2. Caddy ì„¤ì • í™•ì¸**
```bash
# Caddyfile í™•ì¸
cat /etc/caddy/Caddyfile

# Caddy ìƒíƒœ í™•ì¸
sudo systemctl status caddy

# Caddy ë¡œê·¸ í™•ì¸
sudo journalctl -u caddy -n 50
```

**3. ë¸Œë¼ìš°ì € ìºì‹œ ì œê±°**
- Ctrl+Shift+R (í•˜ë“œ ë¦¬ë¡œë“œ)
- ë˜ëŠ” ì‹œí¬ë¦¿ ëª¨ë“œë¡œ í™•ì¸

**4. Caddy ì¬ì‹œì‘**
```bash
sudo systemctl reload caddy
```

### CSS/ì´ë¯¸ì§€ê°€ ê¹¨ì§

#### ì›ì¸
Caddyfileì—ì„œ ë¦¬ì†ŒìŠ¤ ê²½ë¡œ ì„¤ì • ì˜¤ë¥˜

#### í™•ì¸
```bash
# F12 â†’ Network íƒ­ì—ì„œ 404 ì—ëŸ¬ í™•ì¸

# ì˜¬ë°”ë¥¸ ê²½ë¡œ í™•ì¸
ls -la /var/www/misopin.com/css/
ls -la /var/www/misopin.com/images/
```

#### í•´ê²°
Caddyfileì—ì„œ ê¸°ë³¸ root ê²½ë¡œ í™•ì¸:
```caddy
misopin.one-q.xyz {
    root * /var/www/misopin.com  # ì´ ê²½ë¡œê°€ ë§ëŠ”ì§€ í™•ì¸
    # ...
}
```

### ë°ì´í„°ë² ì´ìŠ¤ í™•ì¸

#### ë“±ë¡ëœ í˜ì´ì§€ í™•ì¸
```bash
cd /var/www/misopin-cms
npx tsx scripts/check-static-pages.ts
```

ì¶œë ¥ ì˜ˆì‹œ:
```
ğŸ“‹ CMSì— ë“±ë¡ëœ ì •ì  í˜ì´ì§€ í™•ì¸...

ì´ 19ê°œ í˜ì´ì§€ ë“±ë¡ë¨:

1. index
   ì œëª©: ë©”ì¸ í˜ì´ì§€
   íŒŒì¼: /var/www/misopin-cms/.next/standalone/public/static-pages/index.html
   í¸ì§‘ ê°€ëŠ¥ ìš”ì†Œ: 25ê°œ
```

---

## ê¸°ìˆ  ìƒì„¸

### ì£¼ìš” ê¸°ìˆ  ìŠ¤íƒ

```yaml
Frontend:
  - React 19
  - Next.js 15.5.3 (App Router)
  - TypeScript
  - Tailwind CSS

Backend:
  - Next.js API Routes
  - Prisma ORM
  - PostgreSQL

HTML Processing:
  - Cheerio (ì„œë²„ ì‚¬ì´ë“œ HTML íŒŒì‹±)
  - DOMPurify (XSS ë³´í˜¸)

Web Server:
  - Caddy v2.10.2
  - ìë™ HTTPS (Let's Encrypt)

Deployment:
  - VPS (Ubuntu/Debian)
  - PM2 (í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬)
  - Systemd (Caddy ì„œë¹„ìŠ¤)
```

### ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

#### static_pages í…Œì´ë¸”
```prisma
model static_pages {
  id                   String                 @id
  slug                 String                 @unique
  title                String
  filePath             String
  sections             Json                   // ì„¹ì…˜ ë©”íƒ€ë°ì´í„°
  lastEdited           DateTime
  createdAt            DateTime               @default(now())
  editMode             EditMode               @default(PARSER)
  lastParsedAt         DateTime?
  lastSyncedAt         DateTime?
  syncStatus           SyncStatus             @default(SYNCED)
  version              Int                    @default(1)
  editable_elements    editable_elements[]
  static_page_versions static_page_versions[]
}
```

#### editable_elements í…Œì´ë¸”
```prisma
model editable_elements {
  id               String       @id
  pageId           String
  elementId        String       // data-editable ì†ì„±ê°’
  elementType      ElementType  // TEXT, HTML, IMAGE, BACKGROUND
  selector         String       // CSS selector
  label            String       // í‘œì‹œ ë¼ë²¨
  sectionName      String       // ì„¹ì…˜ ê·¸ë£¹
  defaultValue     String?
  currentValue     String?
  order            Int          @default(0)
  static_pages     static_pages @relation(...)
}
```

### API ì—”ë“œí¬ì¸íŠ¸

#### GET /api/admin/static-pages/[slug]/editable-elements
í˜ì´ì§€ì˜ í¸ì§‘ ê°€ëŠ¥í•œ ìš”ì†Œ ì¡°íšŒ

**ì‘ë‹µ:**
```json
{
  "success": true,
  "sections": [
    {
      "sectionName": "hero",
      "displayName": "ë©”ì¸ ìŠ¬ë¼ì´ë“œ",
      "emoji": "ğŸ ",
      "description": "ë©”ì¸ í˜ì´ì§€ ìƒë‹¨ ìŠ¬ë¼ì´ë“œ",
      "order": 1,
      "elementCount": 3,
      "elements": [
        {
          "id": "index-slide1-title",
          "type": "text",
          "selector": "[data-editable='index-slide1-title']",
          "content": "ì˜¨ë‹¤ë¦¬í”„íŒ…",
          "label": "index-slide1-title",
          "friendlyLabel": "ìŠ¬ë¼ì´ë“œ 1 ì œëª©",
          "icon": "ğŸ“",
          "order": 1
        }
      ]
    }
  ],
  "pageId": "...",
  "pageTitle": "ë©”ì¸ í˜ì´ì§€",
  "totalSections": 5,
  "totalElements": 25
}
```

#### PATCH /api/admin/static-pages/[slug]/elements
í˜ì´ì§€ ìš”ì†Œ ì¼ê´„ ì—…ë°ì´íŠ¸

**ìš”ì²­:**
```json
{
  "updates": [
    {
      "elementId": "index-slide1-title",
      "newValue": "ìˆ˜ì •ëœ ì œëª©",
      "elementType": "TEXT"
    },
    {
      "elementId": "botox-intro-html",
      "newValue": "<p>ì„œì‹ ìˆëŠ” <strong>í…ìŠ¤íŠ¸</strong></p>",
      "elementType": "HTML"
    }
  ]
}
```

**ì‘ë‹µ:**
```json
{
  "success": true,
  "message": "2ê°œ ìš”ì†Œê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤",
  "updated": 2,
  "failed": 0,
  "filePath": "/var/www/.../index.html"
}
```

### HTML ë§ˆí¬ì—… ê·œì¹™

#### í¸ì§‘ ê°€ëŠ¥ ìš”ì†Œ ë§ˆí‚¹

**TEXT ìš”ì†Œ:**
```html
<h3 data-editable="index-slide1-title"
    data-section="hero"
    data-type="text">
  ì˜¨ë‹¤ë¦¬í”„íŒ…
</h3>
```

**HTML ìš”ì†Œ:**
```html
<div data-editable="botox-intro-content"
     data-section="intro"
     data-type="html">
  <p>ì„œì‹ ìˆëŠ” <strong>í…ìŠ¤íŠ¸</strong></p>
</div>
```

**IMAGE ìš”ì†Œ:**
```html
<img data-editable="hero-image"
     data-section="hero"
     data-type="image"
     src="/images/hero.jpg"
     alt="Hero Image">
```

**BACKGROUND ìš”ì†Œ:**
```html
<div data-editable="section-bg"
     data-section="hero"
     data-type="background"
     style="background-image: url('/images/bg.jpg')">
</div>
```

### ë³´ì•ˆ ê¸°ëŠ¥

#### XSS ë³´í˜¸
DOMPurifyë¥¼ ì‚¬ìš©í•œ HTML ìƒˆë‹ˆíƒ€ì´ì¦ˆ:

```typescript
// í—ˆìš©ëœ HTML íƒœê·¸ (HTML íƒ€ì…)
ALLOWED_TAGS: [
  'p', 'br', 'strong', 'em', 'u', 'a',
  'ul', 'ol', 'li',
  'h1', 'h2', 'h3', 'h4', 'h5', 'h6',
  'blockquote', 'code', 'pre'
]

// í—ˆìš©ëœ ì†ì„± (HTML íƒ€ì…)
ALLOWED_ATTR: ['href', 'target', 'rel', 'class']

// TEXT íƒ€ì…ì€ ëª¨ë“  íƒœê·¸ ì œê±°
```

#### ê²€ì¦ ë¡œì§

```typescript
// 1. í•„ìˆ˜ í•„ë“œ ê²€ì¦
if (!update.elementId ||
    update.newValue === undefined ||
    update.newValue === null ||
    !update.elementType) {
  return 400 ì—ëŸ¬
}

// 2. ì´ë¯¸ì§€ URL ê²€ì¦
if (elementType === 'IMAGE' || elementType === 'BACKGROUND') {
  if (!isValidImageUrl(newValue)) {
    return 400 ì—ëŸ¬
  }
}

// 3. HTML ìƒˆë‹ˆíƒ€ì´ì¦ˆ
const sanitized = DOMPurify.sanitize(html, options);
```

### ë°±ì—… ë° ë³µêµ¬

#### ìë™ ë°±ì—…
ëª¨ë“  ìˆ˜ì • ì‹œ ìë™ìœ¼ë¡œ ë°±ì—… íŒŒì¼ ìƒì„±:

```
ì›ë³¸: /var/www/.../index.html
ë°±ì—…: /var/www/.../index.html.backup.1730700000000
```

#### ë³µêµ¬ ë°©ë²•
```bash
# ë°±ì—… íŒŒì¼ í™•ì¸
ls -lt /var/www/misopin-cms/.next/standalone/public/static-pages/*.backup.*

# ë³µêµ¬ (ìµœì‹  ë°±ì—…ìœ¼ë¡œ)
cp /var/www/.../index.html.backup.1730700000000 \
   /var/www/.../index.html
```

### ì„±ëŠ¥ ìµœì í™”

#### ìºì‹± ì „ëµ

```caddy
# ì´ë¯¸ì§€: 30ì¼ ìºì‹±
Cache-Control: public, max-age=2592000

# CSS/JS: 7ì¼ ìºì‹±
Cache-Control: public, max-age=604800

# HTML: ìºì‹œ ì‚¬ìš© ì•ˆ í•¨ (í•­ìƒ ìµœì‹ )
Cache-Control: no-cache, no-store, must-revalidate
```

#### Gzip ì••ì¶•
ëª¨ë“  ì‘ë‹µì— ìë™ ì ìš©:
```caddy
encode gzip
```

---

## ë¶€ë¡

### ìœ ìš©í•œ ëª…ë ¹ì–´ ëª¨ìŒ

#### VPS ì ‘ì†
```bash
ssh user@141.164.60.51
```

#### Caddy ê´€ë¦¬
```bash
# ìƒíƒœ í™•ì¸
sudo systemctl status caddy

# ì¬ì‹œì‘ (ë¬´ì¤‘ë‹¨)
sudo systemctl reload caddy

# ì „ì²´ ì¬ì‹œì‘
sudo systemctl restart caddy

# ë¡œê·¸ í™•ì¸
sudo journalctl -u caddy -f

# ì„¤ì • ê²€ì¦
sudo caddy validate --config /etc/caddy/Caddyfile
```

#### Next.js ì•± ê´€ë¦¬
```bash
# PM2ë¡œ ê´€ë¦¬í•˜ëŠ” ê²½ìš°
pm2 list
pm2 restart misopin-cms
pm2 logs misopin-cms

# ë˜ëŠ” systemdë¡œ ê´€ë¦¬í•˜ëŠ” ê²½ìš°
sudo systemctl status misopin-cms
sudo systemctl restart misopin-cms
```

#### íŒŒì¼ í™•ì¸
```bash
# HTML íŒŒì¼ ëª©ë¡
ls -lh /var/www/misopin-cms/.next/standalone/public/static-pages/

# ìµœê·¼ ìˆ˜ì •ëœ íŒŒì¼
ls -lt /var/www/misopin-cms/.next/standalone/public/static-pages/

# íŒŒì¼ ë‚´ìš© ê²€ìƒ‰
grep "ê²€ìƒ‰ì–´" /var/www/misopin-cms/.next/standalone/public/static-pages/index.html
```

#### ë°ì´í„°ë² ì´ìŠ¤
```bash
# Prisma Studio (GUI)
npx prisma studio

# í˜ì´ì§€ ëª©ë¡ í™•ì¸ ìŠ¤í¬ë¦½íŠ¸
npx tsx scripts/check-static-pages.ts
```

### ë¬¸ì˜ ë° ì§€ì›

#### ê°œë°œ ë¬¸ì„œ
- ì´ íŒŒì¼: `/docs/STATIC_PAGES_CMS_GUIDE.md`
- API ë¬¸ì„œ: `/docs/API.md` (ë³„ë„ ì‘ì„± í•„ìš” ì‹œ)

#### ë¡œê·¸ ìœ„ì¹˜
```
Caddy: /var/log/caddy/misopin-static.log
Next.js: PM2 ë˜ëŠ” systemd ë¡œê·¸
Database: PostgreSQL ë¡œê·¸
```

---

**ìµœì¢… ì—…ë°ì´íŠ¸:** 2025-11-03
**ë²„ì „:** 1.0.0
**ì‘ì„±ì:** Development Team
