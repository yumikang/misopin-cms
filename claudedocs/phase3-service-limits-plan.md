# Phase 3: ì‹œìˆ ë³„ ì˜ˆì•½ í•œë„ ì„¤ì • ê¸°ëŠ¥ êµ¬í˜„ ê³„íš

**ê³„íš ìˆ˜ë¦½ì¼**: 2025-11-06
**ì˜ˆìƒ ì™„ë£Œì¼**: 2025-11-06
**ìš°ì„ ìˆœìœ„**: High
**ë‹´ë‹¹**: Development Team

---

## ğŸ“‹ ëª©ì°¨

1. [ê¸°ëŠ¥ ê°œìš”](#ê¸°ëŠ¥-ê°œìš”)
2. [í˜„ì¬ ìƒíƒœ ë¶„ì„](#í˜„ì¬-ìƒíƒœ-ë¶„ì„)
3. [ìš”êµ¬ì‚¬í•­ ë¶„ì„](#ìš”êµ¬ì‚¬í•­-ë¶„ì„)
4. [ì‹œìŠ¤í…œ ì„¤ê³„](#ì‹œìŠ¤í…œ-ì„¤ê³„)
5. [êµ¬í˜„ ê³„íš](#êµ¬í˜„-ê³„íš)
6. [í…ŒìŠ¤íŠ¸ ê³„íš](#í…ŒìŠ¤íŠ¸-ê³„íš)
7. [ë°°í¬ ê³„íš](#ë°°í¬-ê³„íš)
8. [ë¦¬ìŠ¤í¬ ë¶„ì„](#ë¦¬ìŠ¤í¬-ë¶„ì„)

---

## ê¸°ëŠ¥ ê°œìš”

### ëª©ì 
ê° ì‹œìˆ ë³„ë¡œ í•˜ë£¨ ìµœëŒ€ ì˜ˆì•½ ê°€ëŠ¥ ê±´ìˆ˜ë¥¼ ì œí•œí•˜ì—¬ ë³‘ì› ìš´ì˜ íš¨ìœ¨ì„±ì„ ë†’ì´ê³ , ê³¼ë„í•œ ì˜ˆì•½ì„ ë°©ì§€í•©ë‹ˆë‹¤.

### ë¹„ì¦ˆë‹ˆìŠ¤ ê°€ì¹˜
1. **ìš´ì˜ íš¨ìœ¨ì„±**: ì‹œìˆ ë³„ ì ì • ì˜ˆì•½ ê±´ìˆ˜ ìœ ì§€
2. **í’ˆì§ˆ ê´€ë¦¬**: ê³¼ë„í•œ ì˜ˆì•½ìœ¼ë¡œ ì¸í•œ ì„œë¹„ìŠ¤ í’ˆì§ˆ ì €í•˜ ë°©ì§€
3. **ìì› ê´€ë¦¬**: ì˜ë£Œì§„ ë° ì„¤ë¹„ ë¶€ë‹´ ë¶„ì‚°
4. **ìœ ì—°ì„±**: ì‹œìˆ ë³„ íŠ¹ì„±ì— ë§ëŠ” í•œë„ ì„¤ì •

### ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

#### ì‹œë‚˜ë¦¬ì˜¤ 1: ê³ ë‚œì´ë„ ì‹œìˆ  í•œë„ ì„¤ì •
```
ì‹œìˆ : ë³¼ë¥¨ ë¦¬í”„íŒ…
í˜„ì¬ ë¬¸ì œ: í•˜ë£¨ 10ê±´ ì´ìƒ ì˜ˆì•½ ì‹œ ì˜ë£Œì§„ í”¼ë¡œë„ ì¦ê°€
í•´ê²°: í•˜ë£¨ ìµœëŒ€ 5ê±´ìœ¼ë¡œ í•œë„ ì„¤ì •
```

#### ì‹œë‚˜ë¦¬ì˜¤ 2: ì¸ê¸° ì‹œìˆ  ê´€ë¦¬
```
ì‹œìˆ : ì£¼ë¦„ ë³´í†¡ìŠ¤
í˜„ì¬ ë¬¸ì œ: ì˜ˆì•½ì´ ëª°ë ¤ ëŒ€ê¸° ì‹œê°„ ì¦ê°€
í•´ê²°: í•˜ë£¨ ìµœëŒ€ 8ê±´ìœ¼ë¡œ í•œë„ ì„¤ì •, ì‹œê°„ëŒ€ ë¶„ì‚°
```

#### ì‹œë‚˜ë¦¬ì˜¤ 3: ì‹ ê·œ ì‹œìˆ  ì‹œë²” ìš´ì˜
```
ì‹œìˆ : ì‹ ê·œ ë ˆì´ì € ì‹œìˆ 
í˜„ì¬ ë¬¸ì œ: ì´ˆê¸° ìš´ì˜ìœ¼ë¡œ ì•ˆì •ì„± í™•ì¸ í•„ìš”
í•´ê²°: í•˜ë£¨ ìµœëŒ€ 3ê±´ìœ¼ë¡œ ì œí•œ, ì ì§„ì  í™•ëŒ€
```

---

## í˜„ì¬ ìƒíƒœ ë¶„ì„

### ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ (ê¸°ì¡´)

#### `service_reservation_limits` í…Œì´ë¸” âœ…
```prisma
model service_reservation_limits {
  id          String      @id
  serviceType ServiceType @unique
  isActive    Boolean     @default(true)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime
  dailyLimit  Int         @default(10)
}
```

**ë¶„ì„**:
- âœ… í…Œì´ë¸” ì´ë¯¸ ì¡´ì¬
- âœ… ê¸°ë³¸ í•„ë“œ êµ¬ì¡° ì ì ˆ
- âš ï¸ `ServiceType` enum ì‚¬ìš© (ìœ ì—°ì„± ë¶€ì¡±)
- âš ï¸ `serviceId` ì™¸ë˜í‚¤ ì—†ìŒ (services í…Œì´ë¸”ê³¼ ì§ì ‘ ì—°ê²° ì•ˆ ë¨)

#### `services` í…Œì´ë¸” âœ…
```prisma
model services {
  id                   String                 @id
  code                 String                 @unique @db.VarChar(50)
  name                 String                 @db.VarChar(100)
  description          String?
  category             String?                @db.VarChar(50)
  durationMinutes      Int
  bufferMinutes        Int                    @default(10)
  isActive             Boolean                @default(true)
  displayOrder         Int                    @default(0)
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  clinic_time_slots    clinic_time_slots[]
  manual_time_closures manual_time_closures[]
  reservations         reservations[]
}
```

### êµ¬í˜„ ìƒíƒœ

| ì»´í¬ë„ŒíŠ¸ | ìƒíƒœ | ë¹„ê³  |
|----------|------|------|
| ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ | âœ… ì¡´ì¬ | `service_reservation_limits` í…Œì´ë¸” |
| API ì—”ë“œí¬ì¸íŠ¸ | âŒ ì—†ìŒ | ìƒì„± í•„ìš” |
| ê´€ë¦¬ì UI | âŒ ì—†ìŒ | ìƒì„± í•„ìš” |
| ì˜ˆì•½ ì‹œìŠ¤í…œ í†µí•© | âŒ ì—†ìŒ | í•œë„ ì²´í¬ ë¡œì§ í•„ìš” |
| í…ŒìŠ¤íŠ¸ ì½”ë“œ | âŒ ì—†ìŒ | ì‘ì„± í•„ìš” |

---

## ìš”êµ¬ì‚¬í•­ ë¶„ì„

### ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­

#### FR-1: í•œë„ ì„¤ì • ê´€ë¦¬
- **FR-1.1**: ê´€ë¦¬ìëŠ” ê° ì‹œìˆ ë³„ í•˜ë£¨ ìµœëŒ€ ì˜ˆì•½ ê±´ìˆ˜ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆì–´ì•¼ í•¨
- **FR-1.2**: í•œë„ëŠ” 0 ì´ìƒ 100 ì´í•˜ì˜ ì •ìˆ˜ê°’ì´ì–´ì•¼ í•¨
- **FR-1.3**: í•œë„ 0ì€ "ë¬´ì œí•œ"ì„ ì˜ë¯¸í•¨
- **FR-1.4**: í•œë„ ì„¤ì • ì‹œ ë³€ê²½ ì´ìœ ë¥¼ ê¸°ë¡í•  ìˆ˜ ìˆì–´ì•¼ í•¨
- **FR-1.5**: í•œë„ëŠ” í™œì„±í™”/ë¹„í™œì„±í™” í•  ìˆ˜ ìˆì–´ì•¼ í•¨

#### FR-2: í•œë„ ì¡°íšŒ
- **FR-2.1**: ì „ì²´ ì‹œìˆ ì˜ í•œë„ ëª©ë¡ì„ ì¡°íšŒí•  ìˆ˜ ìˆì–´ì•¼ í•¨
- **FR-2.2**: íŠ¹ì • ì‹œìˆ ì˜ í•œë„ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆì–´ì•¼ í•¨
- **FR-2.3**: í•œë„ ì ìš© ì—¬ë¶€(í™œì„±/ë¹„í™œì„±)ë¥¼ í™•ì¸í•  ìˆ˜ ìˆì–´ì•¼ í•¨

#### FR-3: ì˜ˆì•½ ì‹œ í•œë„ ì²´í¬
- **FR-3.1**: ì˜ˆì•½ ìƒì„± ì‹œ í•´ë‹¹ ì‹œìˆ ì˜ í•˜ë£¨ í•œë„ë¥¼ ì²´í¬í•´ì•¼ í•¨
- **FR-3.2**: í•œë„ ì´ˆê³¼ ì‹œ ì˜ˆì•½ì„ ê±°ë¶€í•´ì•¼ í•¨
- **FR-3.3**: í•œë„ ì´ˆê³¼ ì‹œ ì‚¬ìš©ìì—ê²Œ ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì œê³µí•´ì•¼ í•¨
- **FR-3.4**: í˜„ì¬ ì˜ˆì•½ ê±´ìˆ˜ì™€ ì”ì—¬ í•œë„ë¥¼ í‘œì‹œí•´ì•¼ í•¨

#### FR-4: time-slots API í†µí•©
- **FR-4.1**: ì‹œê°„ëŒ€ ì¡°íšŒ ì‹œ ì”ì—¬ í•œë„ ì •ë³´ë¥¼ í¬í•¨í•´ì•¼ í•¨
- **FR-4.2**: í•œë„ ì†Œì§„ ì‹œ í•´ë‹¹ ë‚ ì§œë¥¼ "ë§ˆê°"ìœ¼ë¡œ í‘œì‹œí•´ì•¼ í•¨
- **FR-4.3**: í•œë„ ì •ë³´ëŠ” ìºì‹±í•˜ì—¬ ì„±ëŠ¥ì„ ìµœì í™”í•´ì•¼ í•¨

### ë¹„ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­

#### NFR-1: ì„±ëŠ¥
- **NFR-1.1**: í•œë„ ì¡°íšŒëŠ” 100ms ì´ë‚´ ì‘ë‹µ
- **NFR-1.2**: í•œë„ ì²´í¬ëŠ” 50ms ì´ë‚´ ì™„ë£Œ
- **NFR-1.3**: ë™ì‹œ ìš”ì²­ ì²˜ë¦¬ (race condition ë°©ì§€)

#### NFR-2: ë³´ì•ˆ
- **NFR-2.1**: í•œë„ ì„¤ì •ì€ SUPER_ADMIN, ADMINë§Œ ê°€ëŠ¥
- **NFR-2.2**: JWT ì¸ì¦ í•„ìˆ˜
- **NFR-2.3**: í•œë„ ë³€ê²½ ì´ë ¥ ê°ì‚¬ ë¡œê·¸ ê¸°ë¡

#### NFR-3: ì‚¬ìš©ì„±
- **NFR-3.1**: ì§ê´€ì ì¸ UI (í•œëˆˆì— ì „ì²´ í•œë„ íŒŒì•… ê°€ëŠ¥)
- **NFR-3.2**: ì¦‰ì‹œ ì ìš© (ì„¤ì • í›„ ë°”ë¡œ ë°˜ì˜)
- **NFR-3.3**: ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€

---

## ì‹œìŠ¤í…œ ì„¤ê³„

### 1. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ê°œì„ 

#### ë¬¸ì œì 
í˜„ì¬ `service_reservation_limits`ëŠ” `ServiceType` enumì„ ì‚¬ìš©í•˜ëŠ”ë°, ì´ëŠ”:
1. `services` í…Œì´ë¸”ê³¼ ì§ì ‘ ì—°ê²° ì•ˆ ë¨
2. ìƒˆë¡œìš´ ì„œë¹„ìŠ¤ ì¶”ê°€ ì‹œ enum ìˆ˜ì • í•„ìš” (ìœ ì—°ì„± ë¶€ì¡±)

#### ê°œì„ ì•ˆ

**Option A: ê¸°ì¡´ í…Œì´ë¸” ìˆ˜ì • (ê¶Œì¥)**
```prisma
model service_reservation_limits {
  id          String    @id @default(uuid())
  serviceId   String    @unique              // services í…Œì´ë¸” FK
  dailyLimit  Int       @default(10)         // 0 = ë¬´ì œí•œ
  isActive    Boolean   @default(true)
  reason      String?                        // ë³€ê²½ ì‚¬ìœ 
  updatedBy   String?   @db.VarChar(255)    // ë³€ê²½ì
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  service     services  @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@index([serviceId])
  @@index([isActive])
}
```

**Option B: ìƒˆ í…Œì´ë¸” ìƒì„± (ëŒ€ì•ˆ)**
```prisma
model service_daily_limits {
  id          String    @id @default(uuid())
  serviceId   String    @unique
  dailyLimit  Int       @default(10)
  isActive    Boolean   @default(true)
  reason      String?
  updatedBy   String?   @db.VarChar(255)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  service     services  @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@index([serviceId])
  @@index([isActive])
}
```

**ê¶Œì¥**: Option A (ê¸°ì¡´ í…Œì´ë¸” ìˆ˜ì •)

**ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ëµ**:
1. ìƒˆ ì»¬ëŸ¼ ì¶”ê°€ (serviceId, reason, updatedBy)
2. ê¸°ì¡´ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ (serviceType â†’ serviceId ë§¤í•‘)
3. serviceType ì»¬ëŸ¼ ì œê±°

#### services í…Œì´ë¸” relation ì¶”ê°€
```prisma
model services {
  id                      String                      @id
  // ... ê¸°ì¡´ í•„ë“œ
  service_reservation_limits service_reservation_limits?
}
```

### 2. API ì„¤ê³„

#### ì—”ë“œí¬ì¸íŠ¸ êµ¬ì¡°

```
/api/admin/service-limits
â”œâ”€â”€ GET     - ì „ì²´ í•œë„ ëª©ë¡ ì¡°íšŒ
â”œâ”€â”€ POST    - í•œë„ ìƒì„±/ìˆ˜ì •
â””â”€â”€ DELETE  - í•œë„ ì‚­ì œ (ë¹„í™œì„±í™”)

/api/admin/service-limits/[serviceId]
â””â”€â”€ GET     - íŠ¹ì • ì„œë¹„ìŠ¤ í•œë„ ì¡°íšŒ

/api/public/reservations/availability
â””â”€â”€ GET     - í•œë„ í¬í•¨ ê°€ìš©ì„± ì¡°íšŒ (ê¸°ì¡´ API í™•ì¥)
```

#### API ìŠ¤í™ ìƒì„¸

##### **GET** `/api/admin/service-limits`
ì „ì²´ ì‹œìˆ  í•œë„ ëª©ë¡ ì¡°íšŒ

**Headers**:
```
Authorization: Bearer <JWT_TOKEN>
```

**Query Parameters**:
```typescript
{
  includeInactive?: boolean; // ë¹„í™œì„± í¬í•¨ ì—¬ë¶€ (default: false)
}
```

**Response** (200 OK):
```json
{
  "success": true,
  "limits": [
    {
      "id": "uuid",
      "serviceId": "uuid",
      "service": {
        "code": "WRINKLE_BOTOX",
        "name": "ì£¼ë¦„ ë³´í†¡ìŠ¤",
        "category": "BOTOX"
      },
      "dailyLimit": 8,
      "isActive": true,
      "reason": "ì˜ë£Œì§„ ì ì • ì—…ë¬´ëŸ‰ ê³ ë ¤",
      "updatedBy": "admin@example.com",
      "updatedAt": "2025-11-06T10:00:00Z"
    },
    {
      "id": "uuid",
      "serviceId": "uuid",
      "service": {
        "code": "VOLUME_LIFTING",
        "name": "ë³¼ë¥¨ ë¦¬í”„íŒ…",
        "category": "FILLER"
      },
      "dailyLimit": 5,
      "isActive": true,
      "reason": "ê³ ë‚œì´ë„ ì‹œìˆ ",
      "updatedBy": "admin@example.com",
      "updatedAt": "2025-11-06T09:30:00Z"
    }
  ],
  "stats": {
    "total": 10,
    "active": 8,
    "inactive": 2
  }
}
```

##### **POST** `/api/admin/service-limits`
í•œë„ ìƒì„± ë˜ëŠ” ìˆ˜ì •

**Headers**:
```
Authorization: Bearer <JWT_TOKEN>
Content-Type: application/json
```

**Request Body**:
```json
{
  "serviceId": "uuid",
  "dailyLimit": 8,
  "isActive": true,
  "reason": "ì˜ë£Œì§„ ì ì • ì—…ë¬´ëŸ‰ ê³ ë ¤"
}
```

**Validation**:
- `serviceId`: í•„ìˆ˜, UUID, services í…Œì´ë¸”ì— ì¡´ì¬í•´ì•¼ í•¨
- `dailyLimit`: í•„ìˆ˜, 0-100 ë²”ìœ„ì˜ ì •ìˆ˜
- `isActive`: ì„ íƒ, boolean (default: true)
- `reason`: ì„ íƒ, ìµœëŒ€ 500ì

**Response** (200 OK):
```json
{
  "success": true,
  "limit": {
    "id": "uuid",
    "serviceId": "uuid",
    "dailyLimit": 8,
    "isActive": true,
    "reason": "ì˜ë£Œì§„ ì ì • ì—…ë¬´ëŸ‰ ê³ ë ¤",
    "updatedBy": "admin@example.com",
    "updatedAt": "2025-11-06T10:00:00Z"
  },
  "message": "í•œë„ê°€ ì„±ê³µì ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤"
}
```

**Error Response** (400 Bad Request):
```json
{
  "success": false,
  "error": "Invalid service ID"
}
```

**Error Response** (409 Conflict):
```json
{
  "success": false,
  "error": "í•œë„ê°€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤. ìˆ˜ì •í•˜ë ¤ë©´ PUTì„ ì‚¬ìš©í•˜ì„¸ìš”."
}
```

##### **DELETE** `/api/admin/service-limits?serviceId=uuid`
í•œë„ ë¹„í™œì„±í™”

**Headers**:
```
Authorization: Bearer <JWT_TOKEN>
```

**Query Parameters**:
```typescript
{
  serviceId: string; // í•„ìˆ˜
}
```

**Response** (200 OK):
```json
{
  "success": true,
  "message": "í•œë„ê°€ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤"
}
```

##### **GET** `/api/admin/service-limits/stats`
í•œë„ í†µê³„ ì¡°íšŒ

**Response** (200 OK):
```json
{
  "success": true,
  "stats": {
    "totalServices": 10,
    "withLimits": 8,
    "withoutLimits": 2,
    "activeToday": [
      {
        "serviceCode": "WRINKLE_BOTOX",
        "serviceName": "ì£¼ë¦„ ë³´í†¡ìŠ¤",
        "dailyLimit": 8,
        "currentCount": 5,
        "remaining": 3,
        "utilizationRate": 0.625
      }
    ]
  }
}
```

### 3. ì˜ˆì•½ ì‹œìŠ¤í…œ í†µí•©

#### í•œë„ ì²´í¬ í”Œë¡œìš°

```
ì‚¬ìš©ì ì˜ˆì•½ ìš”ì²­
    â†“
[1] ì„œë¹„ìŠ¤ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
    â†“
[2] í•œë„ ì„¤ì • ì¡°íšŒ
    â”œâ”€ í•œë„ ì—†ìŒ â†’ [5] ì˜ˆì•½ ìƒì„±
    â””â”€ í•œë„ ìˆìŒ â†’ [3]
         â†“
[3] í•´ë‹¹ ë‚ ì§œ ì˜ˆì•½ ê±´ìˆ˜ ì¡°íšŒ
    â†“
[4] í•œë„ ì²´í¬
    â”œâ”€ í•œë„ ì´ˆê³¼ â†’ ì—ëŸ¬ ë°˜í™˜
    â””â”€ í•œë„ ì—¬ìœ  â†’ [5]
         â†“
[5] ì˜ˆì•½ ìƒì„±
    â†“
[6] ì‘ë‹µ ë°˜í™˜
```

#### êµ¬í˜„ ìœ„ì¹˜

**íŒŒì¼**: `app/api/public/reservations/route.ts`

**ìˆ˜ì • í•„ìš” ë¶€ë¶„**:
```typescript
// POST /api/public/reservations
export async function POST(request: NextRequest) {
  // ... ê¸°ì¡´ ì½”ë“œ

  // [NEW] í•œë„ ì²´í¬ ë¡œì§ ì¶”ê°€
  const limitCheck = await checkServiceDailyLimit(
    serviceId,
    preferredDate
  );

  if (!limitCheck.available) {
    return NextResponse.json({
      success: false,
      error: limitCheck.message,
      details: {
        dailyLimit: limitCheck.dailyLimit,
        currentCount: limitCheck.currentCount,
        date: preferredDate
      }
    }, { status: 400 });
  }

  // ... ê¸°ì¡´ ì˜ˆì•½ ìƒì„± ë¡œì§
}

// ìƒˆë¡œìš´ í—¬í¼ í•¨ìˆ˜
async function checkServiceDailyLimit(
  serviceId: string,
  date: Date
): Promise<{
  available: boolean;
  dailyLimit: number | null;
  currentCount: number;
  message?: string;
}> {
  // í•œë„ ì„¤ì • ì¡°íšŒ
  const limit = await prisma.service_reservation_limits.findUnique({
    where: { serviceId, isActive: true }
  });

  // í•œë„ ì„¤ì • ì—†ìœ¼ë©´ ë¬´ì œí•œ
  if (!limit || limit.dailyLimit === 0) {
    return {
      available: true,
      dailyLimit: null,
      currentCount: 0
    };
  }

  // í•´ë‹¹ ë‚ ì§œ ì˜ˆì•½ ê±´ìˆ˜ ì¡°íšŒ
  const count = await prisma.reservations.count({
    where: {
      serviceId,
      preferredDate: date,
      status: { in: ['PENDING', 'CONFIRMED'] }
    }
  });

  // í•œë„ ì²´í¬
  if (count >= limit.dailyLimit) {
    return {
      available: false,
      dailyLimit: limit.dailyLimit,
      currentCount: count,
      message: `ì£„ì†¡í•©ë‹ˆë‹¤. í•´ë‹¹ ë‚ ì§œì˜ ì˜ˆì•½ì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤. (í•˜ë£¨ í•œë„: ${limit.dailyLimit}ê±´)`
    };
  }

  return {
    available: true,
    dailyLimit: limit.dailyLimit,
    currentCount: count
  };
}
```

### 4. time-slots API í™•ì¥

**íŒŒì¼**: `app/api/public/reservations/time-slots/route.ts`

**ì¶”ê°€ ì •ë³´**:
```typescript
// Responseì— í•œë„ ì •ë³´ ì¶”ê°€
{
  "success": true,
  "date": "2025-11-06",
  "service": {
    "code": "WRINKLE_BOTOX",
    "name": "ì£¼ë¦„ ë³´í†¡ìŠ¤"
  },
  "dailyLimit": {
    "total": 8,
    "used": 5,
    "remaining": 3,
    "isLimited": true
  },
  "slots": [...]
}
```

### 5. UI ì„¤ê³„

#### ê´€ë¦¬ì í˜ì´ì§€ ë ˆì´ì•„ì›ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š ì‹œìˆ ë³„ ì˜ˆì•½ í•œë„ ì„¤ì •                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚ [í†µê³„ ì¹´ë“œ ì„¹ì…˜]                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚  ì „ì²´ ì‹œìˆ   â”‚ â”‚ í•œë„ ì„¤ì •ë¨ â”‚ â”‚   í‰ê·  í•œë„  â”‚       â”‚
â”‚ â”‚     10      â”‚ â”‚      8      â”‚ â”‚    7.5ê±´    â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                         â”‚
â”‚ [ê²€ìƒ‰ ë° í•„í„°]                                          â”‚
â”‚ ğŸ” [ê²€ìƒ‰______________________] [ì¹´í…Œê³ ë¦¬â–¼] [ì „ì²´â–¼]    â”‚
â”‚                                                         â”‚
â”‚ [í•œë„ ëª©ë¡ í…Œì´ë¸”]                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ ì‹œìˆ ëª…   â”‚ ì¹´í…Œê³ ë¦¬ â”‚ í•œë„   â”‚ ìƒíƒœ   â”‚ ì•¡ì…˜     â”‚  â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ â”‚ ì£¼ë¦„ë³´í†¡ìŠ¤â”‚ BOTOX   â”‚ 8ê±´/ì¼ â”‚ âœ…í™œì„± â”‚ [ìˆ˜ì •][X]â”‚  â”‚
â”‚ â”‚ ë³¼ë¥¨ë¦¬í”„íŒ…â”‚ FILLER  â”‚ 5ê±´/ì¼ â”‚ âœ…í™œì„± â”‚ [ìˆ˜ì •][X]â”‚  â”‚
â”‚ â”‚ ê¸°íƒ€ìƒë‹´ â”‚ ìƒë‹´     â”‚ ë¬´ì œí•œ â”‚ âšªë¹„í™œì„±â”‚ [ì„¤ì •]   â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚ [+ ìƒˆ í•œë„ ì„¤ì •]                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### í•œë„ ì„¤ì • ëª¨ë‹¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ í•œë„ ì„¤ì •                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚ ì‹œìˆ  ì„ íƒ: [ì£¼ë¦„ ë³´í†¡ìŠ¤ â–¼]         â”‚
â”‚                                      â”‚
â”‚ í•˜ë£¨ í•œë„: [____8____] ê±´           â”‚
â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚           0 (ë¬´ì œí•œ)    100         â”‚
â”‚                                      â”‚
â”‚ í™œì„±í™”:   [âœ“] ì¦‰ì‹œ ì ìš©             â”‚
â”‚                                      â”‚
â”‚ ë³€ê²½ ì‚¬ìœ : (ì„ íƒì‚¬í•­)                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ì˜ë£Œì§„ ì ì • ì—…ë¬´ëŸ‰ ê³ ë ¤         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚
â”‚ âš ï¸ í˜„ì¬ 5ê±´ ì˜ˆì•½ë¨ (í•œë„ 8ê±´)       â”‚
â”‚                                      â”‚
â”‚ [ì·¨ì†Œ]              [ì €ì¥]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ì‚¬ìš©ì ì˜ˆì•½ í˜ì´ì§€ (calendar-page.html)

í•œë„ ì´ˆê³¼ ì‹œ í‘œì‹œ:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2025ë…„ 11ì›” 6ì¼                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                    â”‚
â”‚ ì‹œìˆ : [ì£¼ë¦„ ë³´í†¡ìŠ¤ â–¼]             â”‚
â”‚                                    â”‚
â”‚ âš ï¸ ì£„ì†¡í•©ë‹ˆë‹¤                      â”‚
â”‚ ì„ íƒí•˜ì‹  ë‚ ì§œì˜ ì˜ˆì•½ì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤â”‚
â”‚ ë‹¤ë¥¸ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.          â”‚
â”‚                                    â”‚
â”‚ â€¢ í˜„ì¬ ì˜ˆì•½: 8/8ê±´                 â”‚
â”‚ â€¢ ë‹¤ìŒ ê°€ëŠ¥ ë‚ ì§œ: 11ì›” 7ì¼         â”‚
â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## êµ¬í˜„ ê³„íš

### Phase 1: ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ (30ë¶„)

#### Task 1.1: Prisma ìŠ¤í‚¤ë§ˆ ìˆ˜ì •
**íŒŒì¼**: `prisma/schema.prisma`

**ì‘ì—… ë‚´ìš©**:
1. `service_reservation_limits` ëª¨ë¸ ìˆ˜ì •
2. `services` ëª¨ë¸ì— relation ì¶”ê°€

**ì˜ˆìƒ ì‹œê°„**: 10ë¶„

#### Task 1.2: ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìƒì„±
```bash
npx prisma migrate dev --name add_service_limits_relations
```

**ì˜ˆìƒ ì‹œê°„**: 5ë¶„

#### Task 1.3: ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸
ê¸°ì¡´ ë°ì´í„°ê°€ ìˆë‹¤ë©´ serviceType â†’ serviceId ë§¤í•‘

**ì˜ˆìƒ ì‹œê°„**: 15ë¶„

### Phase 2: API ê°œë°œ (2ì‹œê°„)

#### Task 2.1: Service Limits API ìƒì„±
**íŒŒì¼**: `app/api/admin/service-limits/route.ts`

**ì‘ì—… ë‚´ìš©**:
1. GET - ì „ì²´ í•œë„ ì¡°íšŒ
2. POST - í•œë„ ìƒì„±/ìˆ˜ì •
3. DELETE - í•œë„ ë¹„í™œì„±í™”

**ì˜ˆìƒ ì‹œê°„**: 60ë¶„

**êµ¬í˜„ ìš°ì„ ìˆœìœ„**:
1. GET ì—”ë“œí¬ì¸íŠ¸ (ê¸°ë³¸ ì¡°íšŒ)
2. POST ì—”ë“œí¬ì¸íŠ¸ (ìƒì„±/ìˆ˜ì •)
3. DELETE ì—”ë“œí¬ì¸íŠ¸ (ë¹„í™œì„±í™”)

#### Task 2.2: í—¬í¼ í•¨ìˆ˜ ì‘ì„±
**íŒŒì¼**: `lib/reservations/service-limits.ts` (ì‹ ê·œ)

**í•¨ìˆ˜ ëª©ë¡**:
```typescript
// í•œë„ ì¡°íšŒ
export async function getServiceLimit(serviceId: string)

// í•œë„ ì²´í¬
export async function checkServiceDailyLimit(
  serviceId: string,
  date: Date
)

// í˜„ì¬ ì˜ˆì•½ ê±´ìˆ˜ ì¡°íšŒ
export async function getServiceReservationCount(
  serviceId: string,
  date: Date
)

// í•œë„ í†µê³„ ì¡°íšŒ
export async function getServiceLimitStats()
```

**ì˜ˆìƒ ì‹œê°„**: 30ë¶„

#### Task 2.3: ì˜ˆì•½ API í†µí•©
**íŒŒì¼**: `app/api/public/reservations/route.ts`

**ì‘ì—… ë‚´ìš©**:
1. POST í•¸ë“¤ëŸ¬ì— í•œë„ ì²´í¬ ë¡œì§ ì¶”ê°€
2. ì—ëŸ¬ ì‘ë‹µ ì²˜ë¦¬

**ì˜ˆìƒ ì‹œê°„**: 30ë¶„

### Phase 3: UI ê°œë°œ (2.5ì‹œê°„)

#### Task 3.1: í•œë„ ì„¤ì • í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸
**íŒŒì¼**: `components/admin/ServiceLimitManager.tsx` (ì‹ ê·œ)

**í•˜ìœ„ ì»´í¬ë„ŒíŠ¸**:
1. `ServiceLimitList` - í•œë„ ëª©ë¡ í…Œì´ë¸”
2. `ServiceLimitForm` - í•œë„ ì„¤ì • í¼
3. `ServiceLimitStats` - í†µê³„ ì¹´ë“œ

**ì˜ˆìƒ ì‹œê°„**: 90ë¶„

#### Task 3.2: ê´€ë¦¬ì í˜ì´ì§€ í†µí•©
**íŒŒì¼**: `app/admin/reservations/page.tsx` ë˜ëŠ” ìƒˆ í˜ì´ì§€

**ì‘ì—… ë‚´ìš©**:
1. ìƒˆ íƒ­ ì¶”ê°€ ë˜ëŠ” ë³„ë„ í˜ì´ì§€ ìƒì„±
2. ServiceLimitManager ì»´í¬ë„ŒíŠ¸ ë°°ì¹˜
3. ë ˆì´ì•„ì›ƒ ì¡°ì •

**ì˜ˆìƒ ì‹œê°„**: 30ë¶„

#### Task 3.3: ì‚¬ìš©ì í˜ì´ì§€ ì—…ë°ì´íŠ¸
**íŒŒì¼**: `public/static-pages/js/time-slot-loader.js`

**ì‘ì—… ë‚´ìš©**:
1. í•œë„ ì •ë³´ í‘œì‹œ ë¡œì§ ì¶”ê°€
2. í•œë„ ì´ˆê³¼ ì‹œ ë©”ì‹œì§€ í‘œì‹œ
3. ë‹¤ìŒ ê°€ëŠ¥ ë‚ ì§œ ì œì•ˆ

**ì˜ˆìƒ ì‹œê°„**: 30ë¶„

### Phase 4: í…ŒìŠ¤íŠ¸ (1.5ì‹œê°„)

#### Task 4.1: API ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
**í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤**:
1. í•œë„ ì¡°íšŒ (ì¡´ì¬/ì—†ìŒ)
2. í•œë„ ìƒì„± (ì„±ê³µ/ì‹¤íŒ¨)
3. í•œë„ ìˆ˜ì • (ì„±ê³µ/ì‹¤íŒ¨)
4. í•œë„ ì²´í¬ (í†µê³¼/ì´ˆê³¼)

**ì˜ˆìƒ ì‹œê°„**: 45ë¶„

#### Task 4.2: í†µí•© í…ŒìŠ¤íŠ¸
**ì‹œë‚˜ë¦¬ì˜¤**:
1. í•œë„ ì„¤ì • â†’ ì˜ˆì•½ ì‹œë„ â†’ ì²´í¬ í™•ì¸
2. í•œë„ ì´ˆê³¼ â†’ ì˜ˆì•½ ê±°ë¶€ í™•ì¸
3. í•œë„ ìˆ˜ì • â†’ ì¦‰ì‹œ ë°˜ì˜ í™•ì¸

**ì˜ˆìƒ ì‹œê°„**: 30ë¶„

#### Task 4.3: UI í…ŒìŠ¤íŠ¸
**í…ŒìŠ¤íŠ¸ í•­ëª©**:
1. í•œë„ ëª©ë¡ í‘œì‹œ
2. í•œë„ ì„¤ì • í¼ ë™ì‘
3. ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
4. í†µê³„ ì •í™•ì„±

**ì˜ˆìƒ ì‹œê°„**: 15ë¶„

### Phase 5: ë°°í¬ (30ë¶„)

#### Task 5.1: ë¡œì»¬ ë¹Œë“œ í…ŒìŠ¤íŠ¸
```bash
npm run build
```

**ì˜ˆìƒ ì‹œê°„**: 10ë¶„

#### Task 5.2: í”„ë¡œë•ì…˜ ë°°í¬
```bash
./deploy.sh
./deploy-calendar-remote.sh
```

**ì˜ˆìƒ ì‹œê°„**: 15ë¶„

#### Task 5.3: í”„ë¡œë•ì…˜ ê²€ì¦
**ê²€ì¦ í•­ëª©**:
1. API ì—”ë“œí¬ì¸íŠ¸ ë™ì‘ í™•ì¸
2. ê´€ë¦¬ì í˜ì´ì§€ ì ‘ê·¼ í™•ì¸
3. ì˜ˆì•½ ì‹œìŠ¤í…œ í•œë„ ì²´í¬ í™•ì¸

**ì˜ˆìƒ ì‹œê°„**: 5ë¶„

---

## í…ŒìŠ¤íŠ¸ ê³„íš

### 1. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

#### API í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤

**GET /api/admin/service-limits**
```
TC-1: ì „ì²´ í•œë„ ëª©ë¡ ì¡°íšŒ ì„±ê³µ
- Given: 8ê°œ ì„œë¹„ìŠ¤ì— í•œë„ ì„¤ì •ë¨
- When: GET ìš”ì²­
- Then: 8ê°œ í•œë„ ë°˜í™˜, 200 OK

TC-2: ë¹„í™œì„± í•œë„ í¬í•¨ ì¡°íšŒ
- Given: 2ê°œ ë¹„í™œì„± í•œë„ ì¡´ì¬
- When: GET ìš”ì²­ (includeInactive=true)
- Then: 10ê°œ í•œë„ ë°˜í™˜ (í™œì„± 8 + ë¹„í™œì„± 2)

TC-3: ì¸ì¦ ì‹¤íŒ¨
- Given: ìœ íš¨í•˜ì§€ ì•Šì€ JWT í† í°
- When: GET ìš”ì²­
- Then: 401 Unauthorized
```

**POST /api/admin/service-limits**
```
TC-4: í•œë„ ìƒì„± ì„±ê³µ
- Given: ìƒˆë¡œìš´ ì„œë¹„ìŠ¤ ID
- When: POST { serviceId, dailyLimit: 8 }
- Then: í•œë„ ìƒì„±ë¨, 200 OK

TC-5: í•œë„ ìˆ˜ì • ì„±ê³µ
- Given: ê¸°ì¡´ í•œë„ ì¡´ì¬
- When: POST { serviceId, dailyLimit: 10 }
- Then: í•œë„ ì—…ë°ì´íŠ¸ë¨, 200 OK

TC-6: ì˜ëª»ëœ í•œë„ ê°’
- Given: ìœ íš¨í•œ ì„œë¹„ìŠ¤ ID
- When: POST { dailyLimit: 150 }
- Then: 400 Bad Request (í•œë„ëŠ” 0-100)

TC-7: ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì„œë¹„ìŠ¤
- Given: ì˜ëª»ëœ ì„œë¹„ìŠ¤ ID
- When: POST ìš”ì²­
- Then: 404 Not Found
```

**checkServiceDailyLimit í•¨ìˆ˜**
```
TC-8: í•œë„ ì—†ìŒ (ë¬´ì œí•œ)
- Given: í•œë„ ì„¤ì • ì—†ëŠ” ì„œë¹„ìŠ¤
- When: checkServiceDailyLimit í˜¸ì¶œ
- Then: available = true, dailyLimit = null

TC-9: í•œë„ ì—¬ìœ  ìˆìŒ
- Given: í•œë„ 8ê±´, í˜„ì¬ 5ê±´ ì˜ˆì•½
- When: checkServiceDailyLimit í˜¸ì¶œ
- Then: available = true, remaining = 3

TC-10: í•œë„ ì´ˆê³¼
- Given: í•œë„ 8ê±´, í˜„ì¬ 8ê±´ ì˜ˆì•½
- When: checkServiceDailyLimit í˜¸ì¶œ
- Then: available = false, message í¬í•¨

TC-11: í•œë„ 0 (ë¬´ì œí•œ)
- Given: dailyLimit = 0
- When: checkServiceDailyLimit í˜¸ì¶œ
- Then: available = true (ë¬´ì œí•œ)
```

### 2. í†µí•© í…ŒìŠ¤íŠ¸

#### ì‹œë‚˜ë¦¬ì˜¤ 1: í•œë„ ì„¤ì • ë° ì˜ˆì•½ ì°¨ë‹¨
```
1. ê´€ë¦¬ì ë¡œê·¸ì¸
2. ì‹œìˆ  "ì£¼ë¦„ ë³´í†¡ìŠ¤" í•œë„ 8ê±´ìœ¼ë¡œ ì„¤ì •
3. í•´ë‹¹ ë‚ ì§œì— 8ê±´ ì˜ˆì•½ ìƒì„±
4. 9ë²ˆì§¸ ì˜ˆì•½ ì‹œë„
5. ì˜ˆì•½ ê±°ë¶€ í™•ì¸ (í•œë„ ì´ˆê³¼ ë©”ì‹œì§€)
```

#### ì‹œë‚˜ë¦¬ì˜¤ 2: í•œë„ ìˆ˜ì • ë° ì¦‰ì‹œ ë°˜ì˜
```
1. ê¸°ì¡´ í•œë„ 8ê±´ â†’ 10ê±´ìœ¼ë¡œ ìˆ˜ì •
2. ì¦‰ì‹œ 2ê±´ ì¶”ê°€ ì˜ˆì•½ ê°€ëŠ¥ í™•ì¸
3. 10ê±´ ì˜ˆì•½ í›„ ì˜ˆì•½ ì°¨ë‹¨ í™•ì¸
```

#### ì‹œë‚˜ë¦¬ì˜¤ 3: í•œë„ ë¹„í™œì„±í™”
```
1. í•œë„ ë¹„í™œì„±í™” (isActive = false)
2. ë¬´ì œí•œ ì˜ˆì•½ ê°€ëŠ¥ í™•ì¸
3. í•œë„ ì¬í™œì„±í™”
4. ê¸°ì¡´ ì˜ˆì•½ ê±´ìˆ˜ë¶€í„° ì²´í¬ í™•ì¸
```

### 3. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

#### ëª©í‘œ
- í•œë„ ì¡°íšŒ: < 100ms
- í•œë„ ì²´í¬: < 50ms
- ë™ì‹œ ì˜ˆì•½ ìš”ì²­ ì²˜ë¦¬

#### í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤
```
PT-1: 100ëª… ë™ì‹œ ì˜ˆì•½ ìš”ì²­
- Given: í•œë„ 10ê±´
- When: 100ëª…ì´ ë™ì‹œì— ì˜ˆì•½ ìš”ì²­
- Then: ì •í™•íˆ 10ê±´ë§Œ ì„±ê³µ, 90ê±´ ê±°ë¶€

PT-2: í•œë„ ì¡°íšŒ ì„±ëŠ¥
- Given: 100ê°œ ì„œë¹„ìŠ¤ í•œë„ ì„¤ì •
- When: ì „ì²´ í•œë„ ì¡°íšŒ
- Then: 100ms ì´ë‚´ ì‘ë‹µ
```

---

## ë°°í¬ ê³„íš

### ë°°í¬ ë‹¨ê³„

#### Stage 1: ê°œë°œ í™˜ê²½ (localhost)
1. ìŠ¤í‚¤ë§ˆ ë§ˆì´ê·¸ë ˆì´ì…˜
2. API ê°œë°œ ë° í…ŒìŠ¤íŠ¸
3. UI ê°œë°œ ë° í…ŒìŠ¤íŠ¸
4. ë¡œì»¬ í†µí•© í…ŒìŠ¤íŠ¸

#### Stage 2: ìŠ¤í…Œì´ì§• (ì„ íƒì‚¬í•­)
1. í”„ë¡œë•ì…˜ ìœ ì‚¬ í™˜ê²½ í…ŒìŠ¤íŠ¸
2. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
3. ë¶€í•˜ í…ŒìŠ¤íŠ¸

#### Stage 3: í”„ë¡œë•ì…˜
1. ë°±ì—… ìƒì„±
2. ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜
3. ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬
4. ë™ì‘ í™•ì¸
5. ë¡¤ë°± ì¤€ë¹„

### ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

**ë°°í¬ ì „**:
- [ ] ë¡œì»¬ ë¹Œë“œ ì„±ê³µ
- [ ] ëª¨ë“  ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ í†µê³¼
- [ ] í†µí•© í…ŒìŠ¤íŠ¸ í†µê³¼
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…
- [ ] ë¡¤ë°± ê³„íš ìˆ˜ë¦½
- [ ] .env íŒŒì¼ í™•ì¸

**ë°°í¬ ì¤‘**:
- [ ] Prisma ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
- [ ] Next.js ë¹Œë“œ
- [ ] íŒŒì¼ rsync
- [ ] PM2 ì¬ì‹œì‘
- [ ] Caddy ë¦¬ë¡œë“œ

**ë°°í¬ í›„**:
- [ ] API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
- [ ] ê´€ë¦¬ì í˜ì´ì§€ ì ‘ê·¼ í™•ì¸
- [ ] ì˜ˆì•½ ì‹œìŠ¤í…œ ë™ì‘ í™•ì¸
- [ ] ë¡œê·¸ ëª¨ë‹ˆí„°ë§ (15ë¶„)
- [ ] ì—ëŸ¬ ì—†ìŒ í™•ì¸

### ë¡¤ë°± ê³„íš

#### ë¡¤ë°± íŠ¸ë¦¬ê±°
- API ì‘ë‹µ ì—ëŸ¬ìœ¨ > 5%
- ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨
- ì¹˜ëª…ì  ë²„ê·¸ ë°œê²¬
- ì„±ëŠ¥ ì €í•˜ > 50%

#### ë¡¤ë°± ì ˆì°¨
```bash
# 1. ì´ì „ ë¹Œë“œë¡œ ë³µêµ¬
cp -r /var/www/backups/[timestamp]/.next /var/www/misopin-cms/

# 2. PM2 ì¬ì‹œì‘
pm2 restart misopin-cms

# 3. ë°ì´í„°ë² ì´ìŠ¤ ë¡¤ë°± (í•„ìš”ì‹œ)
npx prisma migrate resolve --rolled-back [migration_name]

# 4. í™•ì¸
curl https://cms.one-q.xyz/api/health
```

---

## ë¦¬ìŠ¤í¬ ë¶„ì„

### ê¸°ìˆ ì  ë¦¬ìŠ¤í¬

#### Risk-1: Race Condition (ë™ì‹œì„± ë¬¸ì œ)
**ì„¤ëª…**: ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ë™ì‹œì— ì˜ˆì•½ ì‹œ í•œë„ ì´ˆê³¼ ê°€ëŠ¥

**ì˜í–¥ë„**: High
**ë°œìƒ ê°€ëŠ¥ì„±**: Medium

**ì™„í™” ë°©ì•ˆ**:
1. **ë°ì´í„°ë² ì´ìŠ¤ íŠ¸ëœì­ì…˜** ì‚¬ìš©
```typescript
await prisma.$transaction(async (tx) => {
  // 1. í•œë„ ì²´í¬
  const count = await tx.reservations.count({...});

  if (count >= limit.dailyLimit) {
    throw new Error('í•œë„ ì´ˆê³¼');
  }

  // 2. ì˜ˆì•½ ìƒì„±
  await tx.reservations.create({...});
});
```

2. **ë‚™ê´€ì  ì ê¸ˆ** (Optimistic Locking)
3. **Redis ë¶„ì‚° ì ê¸ˆ** (ì„ íƒì‚¬í•­, ê³ íŠ¸ë˜í”½ ì‹œ)

#### Risk-2: ìºì‹œ ë¶ˆì¼ì¹˜
**ì„¤ëª…**: í•œë„ ìˆ˜ì • ì‹œ ìºì‹œëœ ë°ì´í„°ì™€ ë¶ˆì¼ì¹˜

**ì˜í–¥ë„**: Medium
**ë°œìƒ ê°€ëŠ¥ì„±**: Medium

**ì™„í™” ë°©ì•ˆ**:
1. í•œë„ ìˆ˜ì • ì‹œ ìºì‹œ ë¬´íš¨í™”
2. TTL ì§§ê²Œ ì„¤ì • (1-5ë¶„)
3. ìºì‹œ í‚¤ì— ë²„ì „ í¬í•¨

#### Risk-3: ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨
**ì„¤ëª…**: Prisma ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤‘ ì—ëŸ¬ ë°œìƒ

**ì˜í–¥ë„**: High
**ë°œìƒ ê°€ëŠ¥ì„±**: Low

**ì™„í™” ë°©ì•ˆ**:
1. ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…
2. ìŠ¤í…Œì´ì§• í™˜ê²½ì—ì„œ ë¨¼ì € í…ŒìŠ¤íŠ¸
3. ë¡¤ë°± ìŠ¤í¬ë¦½íŠ¸ ì¤€ë¹„

### ë¹„ì¦ˆë‹ˆìŠ¤ ë¦¬ìŠ¤í¬

#### Risk-4: ê¸°ì¡´ ì˜ˆì•½ ì˜í–¥
**ì„¤ëª…**: í•œë„ ì„¤ì • ì‹œ ê¸°ì¡´ ì˜ˆì•½ì´ í•œë„ë¥¼ ì´ˆê³¼í•œ ê²½ìš°

**ì˜í–¥ë„**: Medium
**ë°œìƒ ê°€ëŠ¥ì„±**: High

**ì™„í™” ë°©ì•ˆ**:
1. ê¸°ì¡´ ì˜ˆì•½ì€ ìœ ì§€ (ì†Œê¸‰ ì ìš© ì•ˆ í•¨)
2. ê´€ë¦¬ìì—ê²Œ ê²½ê³  ë©”ì‹œì§€ í‘œì‹œ
3. ì ì§„ì  í•œë„ ì¡°ì • ê¶Œì¥

#### Risk-5: ì‚¬ìš©ì ë¶ˆë§Œ
**ì„¤ëª…**: ê°‘ì‘ìŠ¤ëŸ¬ìš´ í•œë„ ì ìš©ìœ¼ë¡œ ì˜ˆì•½ ë¶ˆê°€

**ì˜í–¥ë„**: Medium
**ë°œìƒ ê°€ëŠ¥ì„±**: Medium

**ì™„í™” ë°©ì•ˆ**:
1. ëª…í™•í•œ ì•ˆë‚´ ë©”ì‹œì§€
2. ëŒ€ì²´ ë‚ ì§œ ì œì•ˆ
3. ê³ ê° ì„¼í„° ì—°ë½ì²˜ ì œê³µ

---

## ì„±ê³µ ì§€í‘œ (KPI)

### ê¸°ëŠ¥ ì§€í‘œ
- [ ] ì „ì²´ ì‹œìˆ  í•œë„ ì„¤ì •ë¥  > 80%
- [ ] í•œë„ ì´ˆê³¼ë¡œ ì¸í•œ ì˜ˆì•½ ê±°ë¶€ìœ¨ ì¸¡ì •
- [ ] API ì‘ë‹µ ì‹œê°„ < 100ms
- [ ] ì—ëŸ¬ìœ¨ < 0.1%

### ë¹„ì¦ˆë‹ˆìŠ¤ ì§€í‘œ
- [ ] ì˜ë£Œì§„ ì—…ë¬´ëŸ‰ ê· ë“± ë¶„ì‚°
- [ ] ê³¼ë„í•œ ì˜ˆì•½ ê°ì†Œ
- [ ] ì„œë¹„ìŠ¤ í’ˆì§ˆ ìœ ì§€
- [ ] ê³ ê° ë¶ˆë§Œ ì¦ê°€ ì—¬ë¶€ ëª¨ë‹ˆí„°ë§

---

## ì¶”ê°€ ê³ ë ¤ì‚¬í•­

### 1. ì‹œê°„ëŒ€ë³„ í•œë„
**í˜„ì¬**: í•˜ë£¨ ì „ì²´ í•œë„ë§Œ ì„¤ì •
**í–¥í›„**: ì˜¤ì „/ì˜¤í›„ ì‹œê°„ëŒ€ë³„ ì„¸ë¶€ í•œë„ ì„¤ì •

**ì˜ˆì‹œ**:
```
ì£¼ë¦„ ë³´í†¡ìŠ¤
- ì˜¤ì „: 5ê±´
- ì˜¤í›„: 3ê±´
- ì „ì²´: 8ê±´
```

### 2. ìš”ì¼ë³„ í•œë„
**í˜„ì¬**: ëª¨ë“  ë‚ ì§œ ë™ì¼ í•œë„
**í–¥í›„**: ìš”ì¼ë³„ ë‹¤ë¥¸ í•œë„ ì„¤ì •

**ì˜ˆì‹œ**:
```
ì£¼ë¦„ ë³´í†¡ìŠ¤
- ì›”~ê¸ˆ: 8ê±´
- í† : 5ê±´
- ì¼: íœ´ì§„
```

### 3. ë™ì  í•œë„ ì¡°ì •
**í˜„ì¬**: ìˆ˜ë™ í•œë„ ì„¤ì •
**í–¥í›„**: AI ê¸°ë°˜ ì˜ˆì¸¡ìœ¼ë¡œ ìë™ ì¡°ì •

**ê³ ë ¤ ìš”ì†Œ**:
- ê³¼ê±° ì˜ˆì•½ íŒ¨í„´
- ì˜ë£Œì§„ ìŠ¤ì¼€ì¤„
- ê³„ì ˆë³„ ìˆ˜ìš” ë³€í™”

---

## ì°¸ê³  ë¬¸ì„œ

### ê´€ë ¨ ë¬¸ì„œ
- [Phase 2: ìˆ˜ë™ ì‹œê°„ ë§ˆê° êµ¬í˜„](./phase2-manual-closure-implementation.md)
- [ì˜ˆì•½ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](./reservation-system-architecture.md)
- [API ìŠ¤í™ ë¬¸ì„œ](./api-specifications.md)

### ì™¸ë¶€ ì°¸ê³ 
- [Prisma íŠ¸ëœì­ì…˜ ë¬¸ì„œ](https://www.prisma.io/docs/concepts/components/prisma-client/transactions)
- [Next.js API Routes](https://nextjs.org/docs/app/building-your-application/routing/route-handlers)

---

## ì‘ì„±ì

**ì‘ì„±ì¼**: 2025-11-06
**ì‘ì„±ì**: Claude (Anthropic AI)
**ë¬¸ì„œ ë²„ì „**: 1.0
**ê²€í† ì**: -

---

## ë³€ê²½ ì´ë ¥

| ë‚ ì§œ | ë²„ì „ | ë³€ê²½ ë‚´ìš© | ì‘ì„±ì |
|------|------|-----------|--------|
| 2025-11-06 | 1.0 | ìµœì´ˆ ì‘ì„± | Claude |

---

## ìŠ¹ì¸

**ê¸°íš ìŠ¹ì¸**: [ ] ëŒ€ê¸°ì¤‘
**ê¸°ìˆ  ê²€í† **: [ ] ëŒ€ê¸°ì¤‘
**êµ¬í˜„ ì‹œì‘**: [ ] ìŠ¹ì¸ í›„
